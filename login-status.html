<!-- import latest release version of all components from polygit -->
<link rel="import" href="https://polygit.org/components/polymer/polymer.html">
<link rel="import" href="https://polygit.org/components/iron-ajax/iron-ajax.html">

<dom-module id="login-status">

  <template>

    <style>
      /* local DOM styles go here */
      :host {
        display: inline-block;
      }
    </style>

    <!-- local DOM goes here -->
    <iron-ajax auto url="/user" handle-as="json" last-response="{{userdata}}"></iron-ajax>
    <iron-ajax id="AjaxPost" url="/logout" method="POST" content-type="application/json;charset=UTF-8" handle-as="document" headers='{"X-Requested-With": "XMLHttpRequest"}' on-response="_handleAjaxPostResponse" on-error="_handleAjaxPostError"></iron-ajax>
    
    <template is="dom-if" if="{{userdata.email}}">
      <div>Logged in Status:</div>
      <div>{{userdata.email}}</div>
<!--
    <iron-request id="AjaxPost"></iron-request>

       <form action="/" method="post">
        <input type="hidden" name="logout" value="" />
        <div class="submit">
          <input type="hidden"> -->
      <div >
        <button on-tap="specialTap" class="btn btn-primary">Logout</button>
      </div>
 <!--          </input>
        </div>
      </form>
       -->
    </template>

    <template is="dom-if" if="{{!userdata.email}}">
      <div>Status: Not Logged in</div>
      <div>
        With Google: <a href="/login/google">click here</a>
      </div>
      <div>
        With Github: <a href="/login/github">click here</a>
      </div>
    </template> 
    
    <div>I will respond</div>
    <div>to a tap on</div>
    <div>any of my children!</div>
    <div id="special">I am special!</div>
  </template>

  <script>
  Polymer({
    is: 'login-status',
    properties: {
      userdata: Object,
    },
    listeners: {
      'tap': 'regularTap',
      'special.tap': 'specialTap',
    },
    regularTap: function(e) {
      alert("Thank you for tapping");
    },
//        this.data = { "logout":"" };
//        var respuesta = this.$.AjaxPost;
//        console.log(respuesta);
//        respuesta.go();
    specialTap: function(e) {
      this.$.AjaxPost.body = {};
      this.$.AjaxPost.generateRequest();
      window.location="/";
//    	this.$.AjaxPost.send({url: '/logout', method: 'post', body: '{}'});
//    	this.$.AjaxPost.xhr.post('/logout', {})
    },
    _handleAjaxPostResponse: function(e) {
        console.log(e);
    },
    _handleAjaxPostError: function(e) {
        console.log('error: ' + e);
    },
  });
  </script>
<!--

 
http://stackoverflow.com/questions/33476444/how-does-http-post-work-in-polymer 
-->

</dom-module>
