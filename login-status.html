<!-- import latest release version of all components from polygit -->
<link rel="import" href="https://polygit.org/components/polymer/polymer.html">
<link rel="import" href="https://polygit.org/components/iron-ajax/iron-ajax.html">
<link rel="import" href="https://polygit.org/components/paper-dialog/paper-dialog.html">
<link rel="import" href="https://polygit.org/components/paper-dialog/paper-dialog.html">
<link rel="import" href="https://polygit.org/components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="https://polygit.org/components/neon-animation/animations/fade-out-animation.html">


<dom-module id="login-status">

  <template>

    <style>
      /* local DOM styles go here */
      :host {
        display: inline-block;
        .googlesignin {
          content:url({{contentpath}}"/login-status/google_signin_buttons/web/1x/btn_google_signin_dark_focus_web.png");
        }
      }
    </style>

    <!-- local DOM goes here -->
    <iron-ajax auto url="/logincheck" handle-as="json" last-response="{{userdata}}"></iron-ajax>
    <iron-ajax id="AjaxPost" url="/logout" method="POST" content-type="application/json;charset=UTF-8" handle-as="document" headers='{"X-Requested-With": "XMLHttpRequest"}' on-response="_handleAjaxPostResponse" on-error="_handleAjaxPostError"></iron-ajax>
    
    <template is="dom-if" if="{{userdata.email}}">
      <div>Logged in as: {{userdata.email}}</div>
      <div>
      <form id="logout" action="/logout" method="post" on-submit="logoutTap">
        <input type="hidden" name="logout" value="" />
        <button>Log out</button>
      </form>
      </div>
    </template>

    <template is="dom-if" if="{{!userdata.email}}">
    <paper-button raised onclick="animated.open()">login</paper-button>
    <paper-dialog id="animated" entry-animation="scale-up-animation" exit-animation="fade-out-animation" with-backdrop>
      <div>
        <a href="/login/google"><div class="googlesignin"><img src="{{contentpath}}/login-status/google_signin_buttons/web/1x/btn_google_signin_dark_normal_web.png" /></div></a>
      </div>
      <div>
        <a href="/login/github"><div class="githubsignin"><img src="{{contentpath}}/login-status/GitHub-Logos/GitHub_Logo.png" width="191" height="61"/></div></a>
      </div>
    </paper-dialog>

    </template> 
  </template>

  <script>
  Polymer({
    is: 'login-status',
    properties: {
      userdata: Object,
      contentpath: String,
    },
    logoutTap: function(e) {
      this.$.AjaxPost.body = {};
      this.$.AjaxPost.generateRequest();
      window.location="/";
    },
    _handleAjaxPostResponse: function(e) {
        console.log(e);
    },
    _handleAjaxPostError: function(e) {
        console.log('error: ' + e);
    },
  });
  </script>
</dom-module>
