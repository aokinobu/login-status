<!-- import latest release version of all components from polygit -->
<link rel="import" href="https://polygit.org/components/polymer/polymer.html">
<link rel="import" href="https://polygit.org/components/iron-ajax/iron-ajax.html">
<dom-module id="login-status">
  <template>
    <style>
      :host {
        display: inline-block;
      }
    </style>

    <iron-ajax auto url="/user" handle-as="json" last-response="{{userdata}}"></iron-ajax>
    <iron-ajax id="AjaxPost" url="/logout" method="POST" content-type="application/json;charset=UTF-8" handle-as="document" headers='{"X-Requested-With": "XMLHttpRequest"}' on-response="_handleAjaxPostResponse" on-error="_handleAjaxPostError"></iron-ajax>
    
    <template is="dom-if" if="{{userdata.email}}">
      <div>Logged in Status:</div>
      <div>{{userdata.email}}</div>
      <div >
        <button on-tap="logoutTap" class="btn btn-primary">Logout</button>
      </div>
    </template>

    <template is="dom-if" if="{{!userdata.email}}">
      <div>Status: Not Logged in</div>
      <div>
        With Google: <a href="/login/google">click here</a>
      </div>
      <div>
        With Github: <a href="/login/github">click here</a>
      </div>
    </template> 
  </template>

  <script>
  Polymer({
    is: 'login-status',
    properties: {
      userdata: Object,
    },
    listeners: {
      'logout.tap': 'logoutTap',
    },
    logoutTap: function(e) {
      this.$.AjaxPost.body = {};
      this.$.AjaxPost.generateRequest();
      window.location="/";
    },
    _handleAjaxPostResponse: function(e) {
        console.log(e);
    },
    _handleAjaxPostError: function(e) {
        console.log('error: ' + e);
    },
  });
  </script>
</dom-module>
